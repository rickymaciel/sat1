/*
 * UINuevoPlano.java
 *
 * Created on 19 de febrero de 2008, 14:04
 */

package vista;

import Datos.Baja;
import Datos.Modificacion;
import controlador.CAlta;
import controlador.CListar;
import java.awt.Dimension;
import java.awt.Toolkit;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Iterator;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;
import negocios.PlanoCTotal;
import negocios.PlanoTasa;
import negocios.Tasa;

/**
 *
 * @author  Administrador
 */
public class UINuevoPlano extends javax.swing.JFrame 
{
    private Collection tasas = new ArrayList();
    private Collection planos = new ArrayList();
    private Collection nuevasTasas = new ArrayList();
    private Collection planoTasas = new ArrayList();
    private boolean guardar = true;
    private boolean modificar = false;
    
    /** Creates new form UINuevoPlano */
    public UINuevoPlano() 
    {
        initComponents();
        Dimension pantalla, cuadro;
        pantalla = Toolkit.getDefaultToolkit().getScreenSize();
	cuadro = this.getSize();
	this.setLocation(((pantalla.width - cuadro.width)/2), (pantalla.height - cuadro.height)/2);
        this.llenarTablas();
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jScrollPane1 = new javax.swing.JScrollPane();
        jTableTasas = new javax.swing.JTable();
        jScrollPane2 = new javax.swing.JScrollPane();
        jTablePlanos = new javax.swing.JTable();
        jLLocalidad1 = new javax.swing.JLabel();
        jTNombre = new javax.swing.JTextField();
        jBGuardar = new javax.swing.JButton();
        jBNuevo = new javax.swing.JButton();
        jBSalir = new javax.swing.JButton();
        jBAgregar = new javax.swing.JButton();
        jScrollPane3 = new javax.swing.JScrollPane();
        jTableNuevasTasas = new javax.swing.JTable();
        jLLocalidad2 = new javax.swing.JLabel();
        jTLeyenda = new javax.swing.JTextField();
        jBModificar = new javax.swing.JButton();
        jBCancelar = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Administracion de Planos");
        setResizable(false);

        jScrollPane1.setBorder(javax.swing.BorderFactory.createTitledBorder("Tasas"));

        jTableTasas.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null},
                {null, null}
            },
            new String [] {
                "Codigo", "Nombre"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane1.setViewportView(jTableTasas);

        jScrollPane2.setBorder(javax.swing.BorderFactory.createTitledBorder("Planos"));

        jTablePlanos.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null},
                {null, null}
            },
            new String [] {
                "Codigo", "Nombre"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jTablePlanos.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jTablePlanosMouseClicked(evt);
            }
        });
        jTablePlanos.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jTablePlanosKeyPressed(evt);
            }
        });
        jScrollPane2.setViewportView(jTablePlanos);

        jLLocalidad1.setBackground(new java.awt.Color(255, 255, 204));
        jLLocalidad1.setText("Nombre");
        jLLocalidad1.setOpaque(true);
        jLLocalidad1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jLLocalidad1KeyPressed(evt);
            }
        });

        jTNombre.setToolTipText("ingrese letras para realizar un filtrado del listado.");
        jTNombre.setDisabledTextColor(new java.awt.Color(51, 51, 51));
        jTNombre.setEnabled(false);
        jTNombre.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jTNombreKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jTNombreKeyReleased(evt);
            }
        });

        jBGuardar.setText("Guardar");
        jBGuardar.setEnabled(false);
        jBGuardar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBGuardarActionPerformed(evt);
            }
        });

        jBNuevo.setText("Nuevo");
        jBNuevo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBNuevoActionPerformed(evt);
            }
        });

        jBSalir.setText("Salir");
        jBSalir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBSalirActionPerformed(evt);
            }
        });

        jBAgregar.setText("->");
        jBAgregar.setEnabled(false);
        jBAgregar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBAgregarActionPerformed(evt);
            }
        });

        jScrollPane3.setBorder(javax.swing.BorderFactory.createTitledBorder("Nuevas Tasas"));

        jTableNuevasTasas.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Nombre"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jTableNuevasTasas.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jTableNuevasTasasKeyPressed(evt);
            }
        });
        jScrollPane3.setViewportView(jTableNuevasTasas);

        jLLocalidad2.setBackground(new java.awt.Color(255, 255, 204));
        jLLocalidad2.setText("Leyenda");
        jLLocalidad2.setOpaque(true);
        jLLocalidad2.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jLLocalidad2KeyPressed(evt);
            }
        });

        jTLeyenda.setToolTipText("ingrese letras para realizar un filtrado del listado.");
        jTLeyenda.setDisabledTextColor(new java.awt.Color(51, 51, 51));
        jTLeyenda.setEnabled(false);
        jTLeyenda.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jTLeyendaKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                jTLeyendaKeyReleased(evt);
            }
        });

        jBModificar.setText("Modificar");
        jBModificar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBModificarActionPerformed(evt);
            }
        });

        jBCancelar.setText("Cancelar");
        jBCancelar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jBCancelarActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addContainerGap()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                            .addComponent(jScrollPane2, javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup()
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addGroup(layout.createSequentialGroup()
                                        .addComponent(jLLocalidad1, javax.swing.GroupLayout.PREFERRED_SIZE, 69, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                        .addComponent(jTNombre, javax.swing.GroupLayout.PREFERRED_SIZE, 286, javax.swing.GroupLayout.PREFERRED_SIZE))
                                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 363, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jBAgregar)
                                .addGap(11, 11, 11)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                    .addGroup(layout.createSequentialGroup()
                                        .addComponent(jLLocalidad2, javax.swing.GroupLayout.PREFERRED_SIZE, 69, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                        .addComponent(jTLeyenda))
                                    .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 288, javax.swing.GroupLayout.PREFERRED_SIZE)))))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(149, 149, 149)
                        .addComponent(jBGuardar, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jBNuevo, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jBModificar, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jBCancelar, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jBSalir, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(15, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(64, 64, 64)
                        .addComponent(jBAgregar))
                    .addComponent(jScrollPane1, 0, 0, Short.MAX_VALUE)
                    .addComponent(jScrollPane3, javax.swing.GroupLayout.DEFAULT_SIZE, 286, Short.MAX_VALUE))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLLocalidad1, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jTNombre, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLLocalidad2, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jTLeyenda, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 156, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jBGuardar, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jBNuevo, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jBModificar, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jBCancelar, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jBSalir, javax.swing.GroupLayout.PREFERRED_SIZE, 25, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(16, 16, 16))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jLLocalidad1KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jLLocalidad1KeyPressed
        // TODO add your handling code here:
    }//GEN-LAST:event_jLLocalidad1KeyPressed

    private void jTNombreKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTNombreKeyPressed
        // TODO add your handling code here:
        if(evt.getKeyCode() == 10)
            this.jTLeyenda.requestFocus();
        if(evt.getKeyCode() == 27)
            this.dispose();
}//GEN-LAST:event_jTNombreKeyPressed

    private void jTNombreKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTNombreKeyReleased
        // TODO add your handling code here:
}//GEN-LAST:event_jTNombreKeyReleased

    private void jBSalirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBSalirActionPerformed
        // TODO add your handling code here:
        this.dispose();
    }//GEN-LAST:event_jBSalirActionPerformed

    private void jBNuevoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBNuevoActionPerformed
        // TODO add your handling code here:
        this.jBGuardar.setEnabled(true);
        this.jTNombre.setEnabled(true);
        this.jBAgregar.setEnabled(true);
        this.jTLeyenda.setEnabled(true);
        this.jTNombre.requestFocus();
        this.modificar = false;
        this.guardar = true;
        this.jTLeyenda.setText("");
        this.jTNombre.setText("");
        this.limpiarPlanosTasas();
    }//GEN-LAST:event_jBNuevoActionPerformed

    private void jLLocalidad2KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jLLocalidad2KeyPressed
        // TODO add your handling code here:
    }//GEN-LAST:event_jLLocalidad2KeyPressed

    private void jTLeyendaKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTLeyendaKeyPressed
        // TODO add your handling code here:
}//GEN-LAST:event_jTLeyendaKeyPressed

    private void jTLeyendaKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTLeyendaKeyReleased
        // TODO add your handling code here:
}//GEN-LAST:event_jTLeyendaKeyReleased

    private void jBAgregarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBAgregarActionPerformed
        // TODO add your handling code here:
        int fila = this.jTableTasas.getSelectedRow();
        int codigo = Integer.parseInt(String.valueOf(this.jTableTasas.getValueAt(fila, 0)));
        if(codigo != 0)
            this.agregarTasa();
        else
        {
            this.limpiarPlanosTasas();
            this.nuevasTasas.clear();
            this.limpiarTasas();
            this.llenarTasas();
        }
    }//GEN-LAST:event_jBAgregarActionPerformed

    private void jTableNuevasTasasKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTableNuevasTasasKeyPressed
        // TODO add your handling code here:
        if(evt.getKeyCode() == 27)
            this.dispose();
        if(evt.getKeyCode() == 127)
            this.quitarTasa();
    }//GEN-LAST:event_jTableNuevasTasasKeyPressed

    private void jBGuardarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBGuardarActionPerformed
        // TODO add your handling code here:
        if(this.control())
            if(this.guardar)
                this.guardar();
            else
                this.modificarPlanosTasa();
        else
            JOptionPane.showMessageDialog(null,"Debe llenar los campos Nombre y leyenda","Faltan datos",JOptionPane.ERROR_MESSAGE);
    }//GEN-LAST:event_jBGuardarActionPerformed

    private void jTablePlanosMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jTablePlanosMouseClicked
        // TODO add your handling code here:
        this.verPlano();
    }//GEN-LAST:event_jTablePlanosMouseClicked

    private void jBModificarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBModificarActionPerformed
        // TODO add your handling code here:
        this.jBGuardar.setEnabled(true);
        this.jTNombre.setEnabled(true);
        this.jBAgregar.setEnabled(true);
        this.jTLeyenda.setEnabled(true);
        this.jTNombre.requestFocus();
        this.jTablePlanos.setEnabled(true);
        this.jBModificar.setEnabled(false);
        this.guardar = false;
        this.modificar = true;
}//GEN-LAST:event_jBModificarActionPerformed

    private void jBCancelarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jBCancelarActionPerformed
        // TODO add your handling code here:
        this.llenarTablas();
        this.jBGuardar.setEnabled(false);
        this.jTNombre.setEnabled(false);
        this.jBAgregar.setEnabled(false);
        this.jTLeyenda.setEnabled(false);
        this.jBModificar.setEnabled(true);
        this.guardar = false;
        this.modificar = true;
        this.limpiarPlanosTasas();
}//GEN-LAST:event_jBCancelarActionPerformed

    private void jTablePlanosKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jTablePlanosKeyPressed
        // TODO add your handling code here:
        if(evt.getKeyCode() == 27)
            this.dispose();
        if(evt.getKeyCode() == 127)
            this.quitarPlano();
    }//GEN-LAST:event_jTablePlanosKeyPressed
    
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new UINuevoPlano().setVisible(true);
            }
        });
    }
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jBAgregar;
    private javax.swing.JButton jBCancelar;
    private javax.swing.JButton jBGuardar;
    private javax.swing.JButton jBModificar;
    private javax.swing.JButton jBNuevo;
    private javax.swing.JButton jBSalir;
    private javax.swing.JLabel jLLocalidad1;
    private javax.swing.JLabel jLLocalidad2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JTextField jTLeyenda;
    private javax.swing.JTextField jTNombre;
    private javax.swing.JTable jTableNuevasTasas;
    private javax.swing.JTable jTablePlanos;
    private javax.swing.JTable jTableTasas;
    // End of variables declaration//GEN-END:variables
    
    
   private void llenarTablas()
   {
       CListar listar = new CListar();
       
       // hay que obtener la coleccion de tasas
       this.tasas.clear();
       this.tasas = listar.hacerListado(new Tasa());
       // hay que obtener la coleccion de planos
       this.planos.clear();
       this.planos = listar.hacerListado(new PlanoCTotal());
       this.planoTasas.clear();
       this.planoTasas = listar.hacerListado(new PlanoTasa());
       this.llenarPlanos();
       this.llenarTasas();
       this.jTLeyenda.setText("");
       this.jTNombre.setText("");
   }
   
   private void llenarTasas()
   {
       Iterator it = this.tasas.iterator();
       this.limpiarTasas();
       DefaultTableModel modelo = (DefaultTableModel)this.jTableTasas.getModel();
       String datos[] = new String[2];
       Tasa t = new Tasa();
       while(it.hasNext())
       {
           t = (Tasa)it.next();
           datos[0] = String.valueOf(t.getIdtasa());
           datos[1] = t.getDenominacion();
           modelo.addRow(datos);
       }
       datos = null;
       it = null;
       t = null;
   }
   
   private void llenarPlanos()
   {
       Iterator it = this.planos.iterator();
       this.limpiarPlanos();
       DefaultTableModel modelo = (DefaultTableModel)this.jTablePlanos.getModel();
       String datos[] = new String[2];
       PlanoCTotal p = new PlanoCTotal();
       while(it.hasNext())
       {
           p = (PlanoCTotal)it.next();
           datos[0] = String.valueOf(p.getIdplanoCTotal());
           datos[1] = p.getNombre();
           modelo.addRow(datos);
       }
       datos = null;
       it = null;
       p = null;
   }
   
   private void limpiarTasas()
   {
       DefaultTableModel modelo = (DefaultTableModel)this.jTableTasas.getModel();
        while(this.jTableTasas.getRowCount() != 0)
                modelo.removeRow(0);
        modelo = null;
   }
   
   private void limpiarPlanos()
   {
       DefaultTableModel modelo = (DefaultTableModel)this.jTablePlanos.getModel();
        while(this.jTablePlanos.getRowCount() != 0)
                modelo.removeRow(0);
        modelo = null;
   }
   
   private void limpiarPlanosTasas()
   {
       DefaultTableModel modelo = (DefaultTableModel)this.jTableNuevasTasas.getModel();
        while(this.jTableNuevasTasas.getRowCount() != 0)
                modelo.removeRow(0);
        modelo = null;
   }
   
   private void agregarTasa()
   {
       DefaultTableModel modelo = (DefaultTableModel)this.jTableNuevasTasas.getModel();
       Tasa tasa = this.obtenerTasa();
       String datos[] = new String[1];
       datos[0] = tasa.getDenominacion();
       modelo.addRow(datos);
       this.nuevasTasas.add(tasa);
   }
   
   private void quitarTasa()
   {
       DefaultTableModel modelo = (DefaultTableModel)this.jTableNuevasTasas.getModel();
       int fila = Integer.parseInt(String.valueOf(this.jTableNuevasTasas.getSelectedRow()));
       Tasa tasa = this.obtenerTasaNombre(String.valueOf(this.jTableNuevasTasas.getValueAt(fila, 0)));
       modelo.removeRow(this.jTableNuevasTasas.getSelectedRow());
       // ahaora quito el objeto de la coleccion
       this.nuevasTasas.remove(tasa);
       tasa = null;
   }
   
   private Tasa obtenerTasa()
   {
       Tasa tasa = new Tasa();
       int codigo;
       Tasa t = new Tasa();
       Iterator it = this.tasas.iterator();
       while(it.hasNext())
       {
           t = (Tasa)it.next();
           codigo = Integer.parseInt(String.valueOf(this.jTableTasas.getValueAt(this.jTableTasas.getSelectedRow(),0)));
           if(codigo == t.getIdtasa())
               tasa = t;
       }
       t = null;
       it = null;
       return tasa;
   }
   
   private Tasa obtenerTasa(int codigo)
   {
       Tasa tasa = new Tasa();
       Tasa t = new Tasa();
       Iterator it = this.tasas.iterator();
       while(it.hasNext())
       {
           t = (Tasa)it.next();
           if(codigo == t.getIdtasa())
               tasa = t;
       }
       t = null;
       it = null;
       return tasa;
   }
   
   private Tasa obtenerTasaNombre(String nombre)
   {
       Tasa tasa = new Tasa();
       Tasa t = new Tasa();
       Iterator it = this.tasas.iterator();
       while(it.hasNext())
       {
           t = (Tasa)it.next();
           if(nombre.trim().equals(t.getDenominacion().trim()))
               tasa = t;
       }
       t = null;
       it = null;
       return tasa;
   }
   
   private boolean control()
   {
       boolean bandera = true;
       if(this.jTLeyenda.getText().trim().length() == 0)
           bandera = false;
       if(this.jTNombre.getText().trim().length() == 0)
           bandera = false;
       return bandera;
   }
   
   private void guardar()
   {
       // tengo que guardar el nuevo plano
       boolean bandera = false;
           PlanoCTotal p = new PlanoCTotal();
           p.setExiste("S");
           p.setLeyenda(this.jTLeyenda.getText().trim().toUpperCase());
           p.setNombre(this.jTNombre.getText().trim().toUpperCase());
           CAlta alta = new CAlta();
           int respuesta = alta.hacerAlta(p);
           if(respuesta != 0)
           {
               p.setIdplanoCTotal(respuesta);
               Iterator it = this.nuevasTasas.iterator();
               Tasa t = new Tasa();
               while(it.hasNext())
               {
                   t = (Tasa)it.next();
                   PlanoTasa pla = new PlanoTasa();
                   pla.setIdplano(p.getIdplanoCTotal());
                   pla.setIdtasa(t.getIdtasa());
                   pla.setExiste("S");
                   // en el metodo encargado de hacer el alta en la tabla planotasa
                   // hay que asignarle el id de plano al objeto pla y recien dar el 
                   // alta.
                   respuesta = alta.hacerAlta(pla);
                   if(respuesta != 0)
                       bandera = true;
                   t = null;
               }
               it = null;
               if(bandera)
                   JOptionPane.showMessageDialog(null,"Error en la carga de datos, intente de nuevo mas tarde","Error",JOptionPane.ERROR_MESSAGE);
               else
               {
                   this.llenarTablas();
                   this.jBGuardar.setEnabled(false);
                    this.jTNombre.setEnabled(false);
                    this.jBAgregar.setEnabled(false);
                    this.jTLeyenda.setEnabled(false);
                    this.modificar = false;
                    this.guardar = true;
                    this.jTLeyenda.setText("");
                    this.jTNombre.setText("");
                    this.limpiarPlanosTasas();
               }
           }
           else
               JOptionPane.showMessageDialog(null,"Faltan datos, debe llenar los campos nombre y leyenda","Datos Incompletos",JOptionPane.ERROR_MESSAGE);
   }
   
   private void verPlano()
   {
       this.limpiarPlanosTasas();
       Iterator it = this.planos.iterator();
       PlanoCTotal p = new PlanoCTotal();
       PlanoCTotal plano = new PlanoCTotal();
       DefaultTableModel modelo = (DefaultTableModel)this.jTableNuevasTasas.getModel();
       String datos[] = new String[1];
       int indice;
       while(it.hasNext())
       {
           p = (PlanoCTotal)it.next();
           indice = Integer.parseInt(String.valueOf(this.jTablePlanos.getValueAt(this.jTablePlanos.getSelectedRow(),0)));
           if(p.getIdplanoCTotal() == indice)
               plano = p;
           p = null;
       }
       it = null;
       this.jTNombre.setText(plano.getNombre().trim());
       //this.jTLeyenda.setText(plano.getLeyenda().trim());
       this.jTLeyenda.setText(plano.getLeyenda());
       Iterator pt = this.planoTasas.iterator();
       PlanoTasa pl = new PlanoTasa();
       while(pt.hasNext())
       {
           pl = (PlanoTasa)pt.next();
           if((pl.getIdplano() == plano.getIdplanoCTotal()) && (pl.getExiste().equals("S")))
           {
               datos[0] = this.obtenerTasa(pl.getIdtasa()).getDenominacion().trim();
               modelo.addRow(datos);
           }
       }
       pl = null;
       pt = null;
   }
   
   private void modificarPlanosTasa()
   {
       boolean bandera = true;
       Modificacion mod = new Modificacion();
       // primero modifico el plano
       PlanoCTotal plano = new PlanoCTotal();
       PlanoCTotal p = new PlanoCTotal();
       Iterator it = this.planos.iterator();
       int indice;
       while(it.hasNext())
       {
           p = (PlanoCTotal)it.next();
           indice = Integer.parseInt(String.valueOf(this.jTablePlanos.getValueAt(this.jTablePlanos.getSelectedRow(),0)));
           if(p.getIdplanoCTotal() == indice)
               plano = p;
           p = null;
       }
       it = null;
       plano.setLeyenda(this.jTLeyenda.getText().trim().toUpperCase());
       plano.setNombre(this.jTNombre.getText().trim().toUpperCase());
       int respuesta = mod.modificar(plano);
       if(respuesta == 0)
           JOptionPane.showMessageDialog(null,"Error al modificar los datos, intente mas tarde"," Error en la base de datos",JOptionPane.ERROR_MESSAGE);
       else
       {
           // ahora modifico las tasas asignadas a ese plano
           // primero borro las tasas asignadas
           Baja baja = new Baja();
           PlanoTasa planoTasa = new PlanoTasa();
           planoTasa.setIdplano(plano.getIdplanoCTotal());
           planoTasa.setExiste("S");
           System.out.println("El valor del id de plano es: "+String.valueOf(planoTasa.getIdplano()));
           respuesta = baja.eliminar(planoTasa);
           // ahora agrego las nuevas tasas a la tea
           CAlta alta = new CAlta();
           Tasa tasa = new Tasa();
           for(int i=0;i<this.jTableNuevasTasas.getRowCount();i++)
           {
               tasa = this.obtenerTasaNombre(String.valueOf(this.jTableNuevasTasas.getValueAt(i, 0)).trim());
               planoTasa.setIdtasa(tasa.getIdtasa());
               if(alta.hacerAlta(planoTasa) != 0)
                   bandera = false;
           }
               
           if(!bandera)
               JOptionPane.showMessageDialog(null,"Error al actualizar los datos, intente de nuevo mas tarde","Error en la actualizacion",JOptionPane.ERROR_MESSAGE);
           else
           {
               this.llenarTablas();
               this.jBGuardar.setEnabled(false);
               this.jBModificar.setEnabled(true);
               this.jTNombre.setEnabled(false);
               this.jBAgregar.setEnabled(false);
               this.jTLeyenda.setEnabled(false);
               this.modificar = false;
               this.guardar = true;
               this.jTLeyenda.setText("");
               this.jTNombre.setText("");
               this.limpiarPlanosTasas();
           }
       }
   }
   
   private void quitarPlano()
   {
       // primero doy de baja al plano
       int fila = this.jTablePlanos.getSelectedRow();
       PlanoCTotal plano = new PlanoCTotal();
       Baja baja = new Baja();
       Iterator it = this.planos.iterator();
       PlanoCTotal p = new PlanoCTotal();
       while(it.hasNext())
       {
           p = (PlanoCTotal)it.next();
           if(Integer.parseInt(String.valueOf(this.jTablePlanos.getValueAt(fila, 0))) == p.getIdplanoCTotal())
               plano = p;
           p = null;
       }
       it = null;
       int respuesta = baja.eliminar(plano);
       if(respuesta == 0)
           JOptionPane.showMessageDialog(null,"Se produjo un error cuando se intentaba eliminar el plano, intente mas tarde","Error en la baja",JOptionPane.ERROR_MESSAGE);
       else
       {
           //ahora doy de baja a las tasas de la tea planos_tasas
           if(this.jTableNuevasTasas.getRowCount() > 0) // solo elimino si hay tasas para eliminar
           {
               PlanoTasa pl = new PlanoTasa();
               pl.setIdplano(plano.getIdplanoCTotal());
               respuesta = baja.eliminar(pl);
               if(respuesta == 0)
                   JOptionPane.showMessageDialog(null,"Se produjo un error cuando se intentaba eliminar las tasas del plano, intente mas tarde","Error en la baja",JOptionPane.ERROR_MESSAGE);
               else
                   System.out.println("Los registros se borraron correctamente");
           }
           this.llenarTablas();
           this.limpiarPlanosTasas();       
       }
   }
}
